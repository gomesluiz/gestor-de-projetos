"use strict";

// Dropzone
$(function () {
  $('#dropzone-demo').dropzone({
    parallelUploads: 2,
    maxFilesize: 50000,
    filesizeBase: 1000,
    addRemoveLinks: true
  }); // Mock the file upload progress (only for the demo)
  //

  Dropzone.prototype.uploadFiles = function (files) {
    var minSteps = 6;
    var maxSteps = 60;
    var timeBetweenSteps = 100;
    var bytesPerStep = 100000;
    var isUploadSuccess = Math.round(Math.random());
    var self = this;

    for (var i = 0; i < files.length; i++) {
      var file = files[i];
      var totalSteps = Math.round(Math.min(maxSteps, Math.max(minSteps, file.size / bytesPerStep)));

      for (var step = 0; step < totalSteps; step++) {
        var duration = timeBetweenSteps * (step + 1);
        setTimeout(function (file, totalSteps, step) {
          return function () {
            file.upload = {
              progress: 100 * (step + 1) / totalSteps,
              total: file.size,
              bytesSent: (step + 1) * file.size / totalSteps
            };
            self.emit('uploadprogress', file, file.upload.progress, file.upload.bytesSent);

            if (file.upload.progress == 100) {
              if (isUploadSuccess) {
                file.status = Dropzone.SUCCESS;
                self.emit('success', file, 'success', null);
              } else {
                file.status = Dropzone.ERROR;
                self.emit('error', file, 'Some upload error', null);
              }

              self.emit('complete', file);
              self.processQueue();
            }
          };
        }(file, totalSteps, step), duration);
      }
    }
  };
}); // Flow.js

$(function () {
  var r = new Flow({
    target: 'http://posttestserver.com/post.php',
    permanentErrors: [500, 501],
    maxChunkRetries: 1,
    chunkRetryInterval: 5000,
    simultaneousUploads: 1
  }); // Flow.js isn't supported, fall back on a different method

  if (!r.support) {
    $('.flow-error').show();
    return;
  } // Show a place for dropping/selecting files


  $('.flow-drop').show();
  r.assignDrop($('.flow-drop')[0]);
  r.assignBrowse($('.flow-browse')[0]);
  r.assignBrowse($('.flow-browse-folder')[0], true);
  r.assignBrowse($('.flow-browse-image')[0], false, false, {
    accept: 'image/*'
  }); // Handle file add event

  r.on('fileAdded', function (file) {
    // Show progress bar
    $('.flow-progress, .flow-list').removeClass('d-none'); // Add the file to the list

    $('.flow-list').append('<li class="flow-file list-group-item flow-file-' + file.uniqueIdentifier + '">' + '<div class="flow-progress media">' + '<div class="media-body">' + '<div><strong class="flow-file-name"></strong> - <em class="flow-file-progress"><span class="text-muted">Waiting...</span></em></div>' + '<div><small class="flow-file-size text-muted"></small></div>' + '</div>' + '<div class="ml-3 align-self-center">' + '<button type="button" class="flow-file-download btn btn-sm icon-btn btn-outline-primary"><i class="ion ion-md-download"></i></button>' + '<button type="button" class="flow-file-pause btn btn-sm icon-btn btn-outline-warning"><i class="ion ion-md-pause"></i></button> ' + '<button type="button" class="flow-file-resume btn btn-sm icon-btn btn-outline-success"><i class="ion ion-md-play"></i></button> ' + '<button type="button" class="flow-file-cancel btn btn-sm icon-btn btn-outline-danger"><i class="ion ion-md-close"></i></button>' + '</div>' + '</div>' + '</li>');
    var $self = $('.flow-file-' + file.uniqueIdentifier);
    $self.find('.flow-file-name').text(file.name);
    $self.find('.flow-file-size').text(readablizeBytes(file.size));
    $self.find('.flow-file-download').attr('href', '/download/' + file.uniqueIdentifier).hide();
    $self.find('.flow-file-pause').on('click', function () {
      file.pause();
      $self.find('.flow-file-pause').hide();
      $self.find('.flow-file-resume').show();
    });
    $self.find('.flow-file-resume').on('click', function () {
      file.resume();
      $self.find('.flow-file-pause').show();
      $self.find('.flow-file-resume').hide();
    }).hide();
    $self.find('.flow-file-cancel').on('click', function () {
      file.cancel();
      $self.remove();
    });
  });
  r.on('filesSubmitted', function (file) {
    r.upload();
  });
  r.on('complete', function () {
    // Hide pause/resume when the upload has completed
    $('.flow-progress .progress-resume-link, .flow-progress .progress-pause-link').hide();
  });
  r.on('fileSuccess', function (file, message) {
    var $self = $('.flow-file-' + file.uniqueIdentifier); // Reflect that the file upload has completed

    $self.find('.flow-file-progress').text('(completed)');
    $self.find('.flow-file-pause, .flow-file-resume').remove();
    $self.find('.flow-file-download').attr('href', '/download/' + file.uniqueIdentifier).show();
  });
  r.on('fileError', function (file, message) {
    // Reflect that the file upload has resulted in error
    $('.flow-file-' + file.uniqueIdentifier + ' .flow-file-progress').addClass('text-danger').text('(file could not be uploaded: ' + message + ')');
  });
  r.on('fileProgress', function (file) {
    // if (!file.averageSpeed || file.averageSpeed.indexOf('undefined') !== -1) { return; }
    console.log(file.averageSpeed); // Handle progress for both the file and the overall upload

    $('.flow-file-' + file.uniqueIdentifier + ' .flow-file-progress').html(Math.floor(file.progress() * 100) + '% ' + readablizeBytes(file.averageSpeed) + '/s ' + secondsToStr(file.timeRemaining()) + ' remaining');
    $('.flow-progress .progress-bar').css({
      width: Math.floor(r.progress() * 100) + '%'
    });
  });
  r.on('uploadStart', function () {
    // Show pause, hide resume
    $('.flow-progress .progress-resume-link').hide();
    $('.flow-progress .progress-pause-link').show();
  });
  r.on('catchAll', function () {
    console.log.apply(console, arguments);
  });
  window.r = {
    pause: function pause() {
      r.pause(); // Show resume, hide pause

      $('.flow-file-resume').show();
      $('.flow-file-pause').hide();
      $('.flow-progress .progress-resume-link').show();
      $('.flow-progress .progress-pause-link').hide();
    },
    cancel: function cancel() {
      r.cancel();
      $('.flow-progress .progress-resume-link').hide();
      $('.flow-progress .progress-pause-link').hide();
      $('.flow-progress .progress-bar').css({
        width: '0%'
      });
      $('.flow-file').remove();
    },
    upload: function upload() {
      $('.flow-file-pause').show();
      $('.flow-file-resume').hide();
      r.resume();
    },
    flow: r
  };

  function readablizeBytes(bytes) {
    if (!bytes) {
      return '0 kB';
    }

    var s = ['bytes', 'kB', 'MB', 'GB', 'TB', 'PB'];
    var e = Math.floor(Math.log(bytes) / Math.log(1024));
    return (bytes / Math.pow(1024, e)).toFixed(2) + " " + s[e];
  }

  function secondsToStr(temp) {
    function numberEnding(number) {
      return number > 1 ? 's' : '';
    }

    var years = Math.floor(temp / 31536000);

    if (years) {
      return years + ' year' + numberEnding(years);
    }

    var days = Math.floor((temp %= 31536000) / 86400);

    if (days) {
      return days + ' day' + numberEnding(days);
    }

    var hours = Math.floor((temp %= 86400) / 3600);

    if (hours) {
      return hours + ' hour' + numberEnding(hours);
    }

    var minutes = Math.floor((temp %= 3600) / 60);

    if (minutes) {
      return minutes + ' minute' + numberEnding(minutes);
    }

    var seconds = temp % 60;
    return seconds + ' second' + numberEnding(seconds);
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL2Zvcm1zX2ZpbGUtdXBsb2FkLmpzIl0sIm5hbWVzIjpbIiQiLCJkcm9wem9uZSIsInBhcmFsbGVsVXBsb2FkcyIsIm1heEZpbGVzaXplIiwiZmlsZXNpemVCYXNlIiwiYWRkUmVtb3ZlTGlua3MiLCJEcm9wem9uZSIsInByb3RvdHlwZSIsInVwbG9hZEZpbGVzIiwiZmlsZXMiLCJtaW5TdGVwcyIsIm1heFN0ZXBzIiwidGltZUJldHdlZW5TdGVwcyIsImJ5dGVzUGVyU3RlcCIsImlzVXBsb2FkU3VjY2VzcyIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsInNlbGYiLCJpIiwibGVuZ3RoIiwiZmlsZSIsInRvdGFsU3RlcHMiLCJtaW4iLCJtYXgiLCJzaXplIiwic3RlcCIsImR1cmF0aW9uIiwic2V0VGltZW91dCIsInVwbG9hZCIsInByb2dyZXNzIiwidG90YWwiLCJieXRlc1NlbnQiLCJlbWl0Iiwic3RhdHVzIiwiU1VDQ0VTUyIsIkVSUk9SIiwicHJvY2Vzc1F1ZXVlIiwiciIsIkZsb3ciLCJ0YXJnZXQiLCJwZXJtYW5lbnRFcnJvcnMiLCJtYXhDaHVua1JldHJpZXMiLCJjaHVua1JldHJ5SW50ZXJ2YWwiLCJzaW11bHRhbmVvdXNVcGxvYWRzIiwic3VwcG9ydCIsInNob3ciLCJhc3NpZ25Ecm9wIiwiYXNzaWduQnJvd3NlIiwiYWNjZXB0Iiwib24iLCJyZW1vdmVDbGFzcyIsImFwcGVuZCIsInVuaXF1ZUlkZW50aWZpZXIiLCIkc2VsZiIsImZpbmQiLCJ0ZXh0IiwibmFtZSIsInJlYWRhYmxpemVCeXRlcyIsImF0dHIiLCJoaWRlIiwicGF1c2UiLCJyZXN1bWUiLCJjYW5jZWwiLCJyZW1vdmUiLCJtZXNzYWdlIiwiYWRkQ2xhc3MiLCJjb25zb2xlIiwibG9nIiwiYXZlcmFnZVNwZWVkIiwiaHRtbCIsImZsb29yIiwic2Vjb25kc1RvU3RyIiwidGltZVJlbWFpbmluZyIsImNzcyIsIndpZHRoIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ3aW5kb3ciLCJmbG93IiwiYnl0ZXMiLCJzIiwiZSIsInBvdyIsInRvRml4ZWQiLCJ0ZW1wIiwibnVtYmVyRW5kaW5nIiwibnVtYmVyIiwieWVhcnMiLCJkYXlzIiwiaG91cnMiLCJtaW51dGVzIiwic2Vjb25kcyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBQSxDQUFDLENBQUMsWUFBVztBQUNYQSxFQUFBQSxDQUFDLENBQUMsZ0JBQUQsQ0FBRCxDQUFvQkMsUUFBcEIsQ0FBNkI7QUFDM0JDLElBQUFBLGVBQWUsRUFBRSxDQURVO0FBRTNCQyxJQUFBQSxXQUFXLEVBQU0sS0FGVTtBQUczQkMsSUFBQUEsWUFBWSxFQUFLLElBSFU7QUFJM0JDLElBQUFBLGNBQWMsRUFBRztBQUpVLEdBQTdCLEVBRFcsQ0FRWDtBQUNBOztBQUNBQyxFQUFBQSxRQUFRLENBQUNDLFNBQVQsQ0FBbUJDLFdBQW5CLEdBQWlDLFVBQVNDLEtBQVQsRUFBZ0I7QUFDL0MsUUFBSUMsUUFBUSxHQUFXLENBQXZCO0FBQ0EsUUFBSUMsUUFBUSxHQUFXLEVBQXZCO0FBQ0EsUUFBSUMsZ0JBQWdCLEdBQUcsR0FBdkI7QUFDQSxRQUFJQyxZQUFZLEdBQU8sTUFBdkI7QUFDQSxRQUFJQyxlQUFlLEdBQUlDLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsRUFBWCxDQUF2QjtBQUVBLFFBQUlDLElBQUksR0FBRyxJQUFYOztBQUVBLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR1YsS0FBSyxDQUFDVyxNQUExQixFQUFrQ0QsQ0FBQyxFQUFuQyxFQUF1QztBQUVyQyxVQUFJRSxJQUFJLEdBQUdaLEtBQUssQ0FBQ1UsQ0FBRCxDQUFoQjtBQUNBLFVBQUlHLFVBQVUsR0FBR1AsSUFBSSxDQUFDQyxLQUFMLENBQVdELElBQUksQ0FBQ1EsR0FBTCxDQUFTWixRQUFULEVBQW1CSSxJQUFJLENBQUNTLEdBQUwsQ0FBU2QsUUFBVCxFQUFtQlcsSUFBSSxDQUFDSSxJQUFMLEdBQVlaLFlBQS9CLENBQW5CLENBQVgsQ0FBakI7O0FBRUEsV0FBSyxJQUFJYSxJQUFJLEdBQUcsQ0FBaEIsRUFBbUJBLElBQUksR0FBR0osVUFBMUIsRUFBc0NJLElBQUksRUFBMUMsRUFBOEM7QUFDNUMsWUFBSUMsUUFBUSxHQUFHZixnQkFBZ0IsSUFBSWMsSUFBSSxHQUFHLENBQVgsQ0FBL0I7QUFFQUUsUUFBQUEsVUFBVSxDQUFDLFVBQVNQLElBQVQsRUFBZUMsVUFBZixFQUEyQkksSUFBM0IsRUFBaUM7QUFDMUMsaUJBQU8sWUFBVztBQUNoQkwsWUFBQUEsSUFBSSxDQUFDUSxNQUFMLEdBQWM7QUFDWkMsY0FBQUEsUUFBUSxFQUFFLE9BQU9KLElBQUksR0FBRyxDQUFkLElBQW1CSixVQURqQjtBQUVaUyxjQUFBQSxLQUFLLEVBQUVWLElBQUksQ0FBQ0ksSUFGQTtBQUdaTyxjQUFBQSxTQUFTLEVBQUUsQ0FBQ04sSUFBSSxHQUFHLENBQVIsSUFBYUwsSUFBSSxDQUFDSSxJQUFsQixHQUF5Qkg7QUFIeEIsYUFBZDtBQU1BSixZQUFBQSxJQUFJLENBQUNlLElBQUwsQ0FBVSxnQkFBVixFQUE0QlosSUFBNUIsRUFBa0NBLElBQUksQ0FBQ1EsTUFBTCxDQUFZQyxRQUE5QyxFQUF3RFQsSUFBSSxDQUFDUSxNQUFMLENBQVlHLFNBQXBFOztBQUNBLGdCQUFJWCxJQUFJLENBQUNRLE1BQUwsQ0FBWUMsUUFBWixJQUF3QixHQUE1QixFQUFpQztBQUUvQixrQkFBSWhCLGVBQUosRUFBcUI7QUFDbkJPLGdCQUFBQSxJQUFJLENBQUNhLE1BQUwsR0FBZTVCLFFBQVEsQ0FBQzZCLE9BQXhCO0FBQ0FqQixnQkFBQUEsSUFBSSxDQUFDZSxJQUFMLENBQVUsU0FBVixFQUFxQlosSUFBckIsRUFBMkIsU0FBM0IsRUFBc0MsSUFBdEM7QUFDRCxlQUhELE1BR087QUFDTEEsZ0JBQUFBLElBQUksQ0FBQ2EsTUFBTCxHQUFlNUIsUUFBUSxDQUFDOEIsS0FBeEI7QUFDQWxCLGdCQUFBQSxJQUFJLENBQUNlLElBQUwsQ0FBVSxPQUFWLEVBQW1CWixJQUFuQixFQUF5QixtQkFBekIsRUFBOEMsSUFBOUM7QUFDRDs7QUFFREgsY0FBQUEsSUFBSSxDQUFDZSxJQUFMLENBQVUsVUFBVixFQUFzQlosSUFBdEI7QUFDQUgsY0FBQUEsSUFBSSxDQUFDbUIsWUFBTDtBQUNEO0FBQ0YsV0FyQkQ7QUFzQkQsU0F2QlUsQ0F1QlRoQixJQXZCUyxFQXVCSEMsVUF2QkcsRUF1QlNJLElBdkJULENBQUQsRUF1QmlCQyxRQXZCakIsQ0FBVjtBQXdCRDtBQUNGO0FBQ0YsR0EzQ0Q7QUE0Q0QsQ0F0REEsQ0FBRCxDLENBd0RBOztBQUNBM0IsQ0FBQyxDQUFDLFlBQVc7QUFDWCxNQUFJc0MsQ0FBQyxHQUFHLElBQUlDLElBQUosQ0FBUztBQUNmQyxJQUFBQSxNQUFNLEVBQUUsb0NBRE87QUFFZkMsSUFBQUEsZUFBZSxFQUFFLENBQUMsR0FBRCxFQUFNLEdBQU4sQ0FGRjtBQUdmQyxJQUFBQSxlQUFlLEVBQUUsQ0FIRjtBQUlmQyxJQUFBQSxrQkFBa0IsRUFBRSxJQUpMO0FBS2ZDLElBQUFBLG1CQUFtQixFQUFFO0FBTE4sR0FBVCxDQUFSLENBRFcsQ0FTWDs7QUFDQSxNQUFJLENBQUNOLENBQUMsQ0FBQ08sT0FBUCxFQUFnQjtBQUNkN0MsSUFBQUEsQ0FBQyxDQUFDLGFBQUQsQ0FBRCxDQUFpQjhDLElBQWpCO0FBQ0E7QUFDRCxHQWJVLENBZVg7OztBQUNBOUMsRUFBQUEsQ0FBQyxDQUFDLFlBQUQsQ0FBRCxDQUFnQjhDLElBQWhCO0FBQ0FSLEVBQUFBLENBQUMsQ0FBQ1MsVUFBRixDQUFhL0MsQ0FBQyxDQUFDLFlBQUQsQ0FBRCxDQUFnQixDQUFoQixDQUFiO0FBQ0FzQyxFQUFBQSxDQUFDLENBQUNVLFlBQUYsQ0FBZWhELENBQUMsQ0FBQyxjQUFELENBQUQsQ0FBa0IsQ0FBbEIsQ0FBZjtBQUNBc0MsRUFBQUEsQ0FBQyxDQUFDVSxZQUFGLENBQWVoRCxDQUFDLENBQUMscUJBQUQsQ0FBRCxDQUF5QixDQUF6QixDQUFmLEVBQTRDLElBQTVDO0FBQ0FzQyxFQUFBQSxDQUFDLENBQUNVLFlBQUYsQ0FBZWhELENBQUMsQ0FBQyxvQkFBRCxDQUFELENBQXdCLENBQXhCLENBQWYsRUFBMkMsS0FBM0MsRUFBa0QsS0FBbEQsRUFBeUQ7QUFBQ2lELElBQUFBLE1BQU0sRUFBRTtBQUFULEdBQXpELEVBcEJXLENBc0JYOztBQUNBWCxFQUFBQSxDQUFDLENBQUNZLEVBQUYsQ0FBSyxXQUFMLEVBQWtCLFVBQVM3QixJQUFULEVBQWM7QUFDOUI7QUFDQXJCLElBQUFBLENBQUMsQ0FBQyw0QkFBRCxDQUFELENBQWdDbUQsV0FBaEMsQ0FBNEMsUUFBNUMsRUFGOEIsQ0FJOUI7O0FBQ0FuRCxJQUFBQSxDQUFDLENBQUMsWUFBRCxDQUFELENBQWdCb0QsTUFBaEIsQ0FDRSxvREFBa0QvQixJQUFJLENBQUNnQyxnQkFBdkQsR0FBd0UsSUFBeEUsR0FDRSxtQ0FERixHQUVJLDBCQUZKLEdBR00sc0lBSE4sR0FJTSw4REFKTixHQUtJLFFBTEosR0FNSSxzQ0FOSixHQU9NLHVJQVBOLEdBUU0sa0lBUk4sR0FTTSxrSUFUTixHQVVNLGlJQVZOLEdBV0ksUUFYSixHQVlFLFFBWkYsR0FhQSxPQWRGO0FBZ0JBLFFBQUlDLEtBQUssR0FBR3RELENBQUMsQ0FBQyxnQkFBY3FCLElBQUksQ0FBQ2dDLGdCQUFwQixDQUFiO0FBQ0FDLElBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLGlCQUFYLEVBQThCQyxJQUE5QixDQUFtQ25DLElBQUksQ0FBQ29DLElBQXhDO0FBQ0FILElBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLGlCQUFYLEVBQThCQyxJQUE5QixDQUFtQ0UsZUFBZSxDQUFDckMsSUFBSSxDQUFDSSxJQUFOLENBQWxEO0FBQ0E2QixJQUFBQSxLQUFLLENBQUNDLElBQU4sQ0FBVyxxQkFBWCxFQUFrQ0ksSUFBbEMsQ0FBdUMsTUFBdkMsRUFBK0MsZUFBZXRDLElBQUksQ0FBQ2dDLGdCQUFuRSxFQUFxRk8sSUFBckY7QUFDQU4sSUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVcsa0JBQVgsRUFBK0JMLEVBQS9CLENBQWtDLE9BQWxDLEVBQTJDLFlBQVk7QUFDckQ3QixNQUFBQSxJQUFJLENBQUN3QyxLQUFMO0FBQ0FQLE1BQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLGtCQUFYLEVBQStCSyxJQUEvQjtBQUNBTixNQUFBQSxLQUFLLENBQUNDLElBQU4sQ0FBVyxtQkFBWCxFQUFnQ1QsSUFBaEM7QUFDRCxLQUpEO0FBS0FRLElBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLG1CQUFYLEVBQWdDTCxFQUFoQyxDQUFtQyxPQUFuQyxFQUE0QyxZQUFZO0FBQ3REN0IsTUFBQUEsSUFBSSxDQUFDeUMsTUFBTDtBQUNBUixNQUFBQSxLQUFLLENBQUNDLElBQU4sQ0FBVyxrQkFBWCxFQUErQlQsSUFBL0I7QUFDQVEsTUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVcsbUJBQVgsRUFBZ0NLLElBQWhDO0FBQ0QsS0FKRCxFQUlHQSxJQUpIO0FBS0FOLElBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLG1CQUFYLEVBQWdDTCxFQUFoQyxDQUFtQyxPQUFuQyxFQUE0QyxZQUFZO0FBQ3REN0IsTUFBQUEsSUFBSSxDQUFDMEMsTUFBTDtBQUNBVCxNQUFBQSxLQUFLLENBQUNVLE1BQU47QUFDRCxLQUhEO0FBSUQsR0F2Q0Q7QUF3Q0ExQixFQUFBQSxDQUFDLENBQUNZLEVBQUYsQ0FBSyxnQkFBTCxFQUF1QixVQUFTN0IsSUFBVCxFQUFlO0FBQ3BDaUIsSUFBQUEsQ0FBQyxDQUFDVCxNQUFGO0FBQ0QsR0FGRDtBQUdBUyxFQUFBQSxDQUFDLENBQUNZLEVBQUYsQ0FBSyxVQUFMLEVBQWlCLFlBQVU7QUFDekI7QUFDQWxELElBQUFBLENBQUMsQ0FBQywyRUFBRCxDQUFELENBQStFNEQsSUFBL0U7QUFDRCxHQUhEO0FBSUF0QixFQUFBQSxDQUFDLENBQUNZLEVBQUYsQ0FBSyxhQUFMLEVBQW9CLFVBQVM3QixJQUFULEVBQWM0QyxPQUFkLEVBQXNCO0FBQ3hDLFFBQUlYLEtBQUssR0FBR3RELENBQUMsQ0FBQyxnQkFBY3FCLElBQUksQ0FBQ2dDLGdCQUFwQixDQUFiLENBRHdDLENBRXhDOztBQUNBQyxJQUFBQSxLQUFLLENBQUNDLElBQU4sQ0FBVyxxQkFBWCxFQUFrQ0MsSUFBbEMsQ0FBdUMsYUFBdkM7QUFDQUYsSUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVcscUNBQVgsRUFBa0RTLE1BQWxEO0FBQ0FWLElBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLHFCQUFYLEVBQWtDSSxJQUFsQyxDQUF1QyxNQUF2QyxFQUErQyxlQUFldEMsSUFBSSxDQUFDZ0MsZ0JBQW5FLEVBQXFGUCxJQUFyRjtBQUNELEdBTkQ7QUFPQVIsRUFBQUEsQ0FBQyxDQUFDWSxFQUFGLENBQUssV0FBTCxFQUFrQixVQUFTN0IsSUFBVCxFQUFlNEMsT0FBZixFQUF1QjtBQUN2QztBQUNBakUsSUFBQUEsQ0FBQyxDQUFDLGdCQUFjcUIsSUFBSSxDQUFDZ0MsZ0JBQW5CLEdBQW9DLHNCQUFyQyxDQUFELENBQ0dhLFFBREgsQ0FDWSxhQURaLEVBRUdWLElBRkgsQ0FFUSxrQ0FBa0NTLE9BQWxDLEdBQTRDLEdBRnBEO0FBR0QsR0FMRDtBQU1BM0IsRUFBQUEsQ0FBQyxDQUFDWSxFQUFGLENBQUssY0FBTCxFQUFxQixVQUFTN0IsSUFBVCxFQUFjO0FBQ2pDO0FBQ0E4QyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWS9DLElBQUksQ0FBQ2dELFlBQWpCLEVBRmlDLENBSWpDOztBQUNBckUsSUFBQUEsQ0FBQyxDQUFDLGdCQUFjcUIsSUFBSSxDQUFDZ0MsZ0JBQW5CLEdBQW9DLHNCQUFyQyxDQUFELENBQ0dpQixJQURILENBQ1F2RCxJQUFJLENBQUN3RCxLQUFMLENBQVdsRCxJQUFJLENBQUNTLFFBQUwsS0FBZ0IsR0FBM0IsSUFBa0MsSUFBbEMsR0FDRjRCLGVBQWUsQ0FBQ3JDLElBQUksQ0FBQ2dELFlBQU4sQ0FEYixHQUNtQyxLQURuQyxHQUVGRyxZQUFZLENBQUNuRCxJQUFJLENBQUNvRCxhQUFMLEVBQUQsQ0FGVixHQUVtQyxZQUgzQztBQUlBekUsSUFBQUEsQ0FBQyxDQUFDLDhCQUFELENBQUQsQ0FBa0MwRSxHQUFsQyxDQUFzQztBQUFDQyxNQUFBQSxLQUFLLEVBQUM1RCxJQUFJLENBQUN3RCxLQUFMLENBQVdqQyxDQUFDLENBQUNSLFFBQUYsS0FBYSxHQUF4QixJQUErQjtBQUF0QyxLQUF0QztBQUNELEdBVkQ7QUFXQVEsRUFBQUEsQ0FBQyxDQUFDWSxFQUFGLENBQUssYUFBTCxFQUFvQixZQUFVO0FBQzVCO0FBQ0FsRCxJQUFBQSxDQUFDLENBQUMsc0NBQUQsQ0FBRCxDQUEwQzRELElBQTFDO0FBQ0E1RCxJQUFBQSxDQUFDLENBQUMscUNBQUQsQ0FBRCxDQUF5QzhDLElBQXpDO0FBQ0QsR0FKRDtBQUtBUixFQUFBQSxDQUFDLENBQUNZLEVBQUYsQ0FBSyxVQUFMLEVBQWlCLFlBQVc7QUFDMUJpQixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWVEsS0FBWixDQUFrQlQsT0FBbEIsRUFBMkJVLFNBQTNCO0FBQ0QsR0FGRDtBQUdBQyxFQUFBQSxNQUFNLENBQUN4QyxDQUFQLEdBQVc7QUFDVHVCLElBQUFBLEtBQUssRUFBRSxpQkFBWTtBQUNqQnZCLE1BQUFBLENBQUMsQ0FBQ3VCLEtBQUYsR0FEaUIsQ0FFakI7O0FBQ0E3RCxNQUFBQSxDQUFDLENBQUMsbUJBQUQsQ0FBRCxDQUF1QjhDLElBQXZCO0FBQ0E5QyxNQUFBQSxDQUFDLENBQUMsa0JBQUQsQ0FBRCxDQUFzQjRELElBQXRCO0FBQ0E1RCxNQUFBQSxDQUFDLENBQUMsc0NBQUQsQ0FBRCxDQUEwQzhDLElBQTFDO0FBQ0E5QyxNQUFBQSxDQUFDLENBQUMscUNBQUQsQ0FBRCxDQUF5QzRELElBQXpDO0FBQ0QsS0FSUTtBQVNURyxJQUFBQSxNQUFNLEVBQUUsa0JBQVc7QUFDakJ6QixNQUFBQSxDQUFDLENBQUN5QixNQUFGO0FBQ0EvRCxNQUFBQSxDQUFDLENBQUMsc0NBQUQsQ0FBRCxDQUEwQzRELElBQTFDO0FBQ0E1RCxNQUFBQSxDQUFDLENBQUMscUNBQUQsQ0FBRCxDQUF5QzRELElBQXpDO0FBQ0E1RCxNQUFBQSxDQUFDLENBQUMsOEJBQUQsQ0FBRCxDQUFrQzBFLEdBQWxDLENBQXNDO0FBQUNDLFFBQUFBLEtBQUssRUFBRTtBQUFSLE9BQXRDO0FBQ0EzRSxNQUFBQSxDQUFDLENBQUMsWUFBRCxDQUFELENBQWdCZ0UsTUFBaEI7QUFDRCxLQWZRO0FBZ0JUbkMsSUFBQUEsTUFBTSxFQUFFLGtCQUFXO0FBQ2pCN0IsTUFBQUEsQ0FBQyxDQUFDLGtCQUFELENBQUQsQ0FBc0I4QyxJQUF0QjtBQUNBOUMsTUFBQUEsQ0FBQyxDQUFDLG1CQUFELENBQUQsQ0FBdUI0RCxJQUF2QjtBQUNBdEIsTUFBQUEsQ0FBQyxDQUFDd0IsTUFBRjtBQUNELEtBcEJRO0FBcUJUaUIsSUFBQUEsSUFBSSxFQUFFekM7QUFyQkcsR0FBWDs7QUF3QkEsV0FBU29CLGVBQVQsQ0FBeUJzQixLQUF6QixFQUFnQztBQUM5QixRQUFJLENBQUNBLEtBQUwsRUFBWTtBQUFFLGFBQU8sTUFBUDtBQUFnQjs7QUFFOUIsUUFBSUMsQ0FBQyxHQUFHLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0IsSUFBaEIsRUFBc0IsSUFBdEIsRUFBNEIsSUFBNUIsRUFBa0MsSUFBbEMsQ0FBUjtBQUNBLFFBQUlDLENBQUMsR0FBR25FLElBQUksQ0FBQ3dELEtBQUwsQ0FBV3hELElBQUksQ0FBQ3FELEdBQUwsQ0FBU1ksS0FBVCxJQUFrQmpFLElBQUksQ0FBQ3FELEdBQUwsQ0FBUyxJQUFULENBQTdCLENBQVI7QUFDQSxXQUFPLENBQUNZLEtBQUssR0FBR2pFLElBQUksQ0FBQ29FLEdBQUwsQ0FBUyxJQUFULEVBQWVELENBQWYsQ0FBVCxFQUE0QkUsT0FBNUIsQ0FBb0MsQ0FBcEMsSUFBeUMsR0FBekMsR0FBK0NILENBQUMsQ0FBQ0MsQ0FBRCxDQUF2RDtBQUNEOztBQUNELFdBQVNWLFlBQVQsQ0FBdUJhLElBQXZCLEVBQTZCO0FBQzNCLGFBQVNDLFlBQVQsQ0FBdUJDLE1BQXZCLEVBQStCO0FBQzdCLGFBQVFBLE1BQU0sR0FBRyxDQUFWLEdBQWUsR0FBZixHQUFxQixFQUE1QjtBQUNEOztBQUNELFFBQUlDLEtBQUssR0FBR3pFLElBQUksQ0FBQ3dELEtBQUwsQ0FBV2MsSUFBSSxHQUFHLFFBQWxCLENBQVo7O0FBQ0EsUUFBSUcsS0FBSixFQUFXO0FBQ1QsYUFBT0EsS0FBSyxHQUFHLE9BQVIsR0FBa0JGLFlBQVksQ0FBQ0UsS0FBRCxDQUFyQztBQUNEOztBQUNELFFBQUlDLElBQUksR0FBRzFFLElBQUksQ0FBQ3dELEtBQUwsQ0FBVyxDQUFDYyxJQUFJLElBQUksUUFBVCxJQUFxQixLQUFoQyxDQUFYOztBQUNBLFFBQUlJLElBQUosRUFBVTtBQUNSLGFBQU9BLElBQUksR0FBRyxNQUFQLEdBQWdCSCxZQUFZLENBQUNHLElBQUQsQ0FBbkM7QUFDRDs7QUFDRCxRQUFJQyxLQUFLLEdBQUczRSxJQUFJLENBQUN3RCxLQUFMLENBQVcsQ0FBQ2MsSUFBSSxJQUFJLEtBQVQsSUFBa0IsSUFBN0IsQ0FBWjs7QUFDQSxRQUFJSyxLQUFKLEVBQVc7QUFDVCxhQUFPQSxLQUFLLEdBQUcsT0FBUixHQUFrQkosWUFBWSxDQUFDSSxLQUFELENBQXJDO0FBQ0Q7O0FBQ0QsUUFBSUMsT0FBTyxHQUFHNUUsSUFBSSxDQUFDd0QsS0FBTCxDQUFXLENBQUNjLElBQUksSUFBSSxJQUFULElBQWlCLEVBQTVCLENBQWQ7O0FBQ0EsUUFBSU0sT0FBSixFQUFhO0FBQ1gsYUFBT0EsT0FBTyxHQUFHLFNBQVYsR0FBc0JMLFlBQVksQ0FBQ0ssT0FBRCxDQUF6QztBQUNEOztBQUNELFFBQUlDLE9BQU8sR0FBR1AsSUFBSSxHQUFHLEVBQXJCO0FBQ0EsV0FBT08sT0FBTyxHQUFHLFNBQVYsR0FBc0JOLFlBQVksQ0FBQ00sT0FBRCxDQUF6QztBQUNEO0FBQ0YsQ0E1SkEsQ0FBRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIERyb3B6b25lXG4kKGZ1bmN0aW9uKCkge1xuICAkKCcjZHJvcHpvbmUtZGVtbycpLmRyb3B6b25lKHtcbiAgICBwYXJhbGxlbFVwbG9hZHM6IDIsXG4gICAgbWF4RmlsZXNpemU6ICAgICA1MDAwMCxcbiAgICBmaWxlc2l6ZUJhc2U6ICAgIDEwMDAsXG4gICAgYWRkUmVtb3ZlTGlua3M6ICB0cnVlLFxuICB9KTtcblxuICAvLyBNb2NrIHRoZSBmaWxlIHVwbG9hZCBwcm9ncmVzcyAob25seSBmb3IgdGhlIGRlbW8pXG4gIC8vXG4gIERyb3B6b25lLnByb3RvdHlwZS51cGxvYWRGaWxlcyA9IGZ1bmN0aW9uKGZpbGVzKSB7XG4gICAgdmFyIG1pblN0ZXBzICAgICAgICAgPSA2O1xuICAgIHZhciBtYXhTdGVwcyAgICAgICAgID0gNjA7XG4gICAgdmFyIHRpbWVCZXR3ZWVuU3RlcHMgPSAxMDA7XG4gICAgdmFyIGJ5dGVzUGVyU3RlcCAgICAgPSAxMDAwMDA7XG4gICAgdmFyIGlzVXBsb2FkU3VjY2VzcyAgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkpO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICB2YXIgZmlsZSA9IGZpbGVzW2ldO1xuICAgICAgdmFyIHRvdGFsU3RlcHMgPSBNYXRoLnJvdW5kKE1hdGgubWluKG1heFN0ZXBzLCBNYXRoLm1heChtaW5TdGVwcywgZmlsZS5zaXplIC8gYnl0ZXNQZXJTdGVwKSkpO1xuXG4gICAgICBmb3IgKHZhciBzdGVwID0gMDsgc3RlcCA8IHRvdGFsU3RlcHM7IHN0ZXArKykge1xuICAgICAgICB2YXIgZHVyYXRpb24gPSB0aW1lQmV0d2VlblN0ZXBzICogKHN0ZXAgKyAxKTtcblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKGZpbGUsIHRvdGFsU3RlcHMsIHN0ZXApIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmaWxlLnVwbG9hZCA9IHtcbiAgICAgICAgICAgICAgcHJvZ3Jlc3M6IDEwMCAqIChzdGVwICsgMSkgLyB0b3RhbFN0ZXBzLFxuICAgICAgICAgICAgICB0b3RhbDogZmlsZS5zaXplLFxuICAgICAgICAgICAgICBieXRlc1NlbnQ6IChzdGVwICsgMSkgKiBmaWxlLnNpemUgLyB0b3RhbFN0ZXBzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzZWxmLmVtaXQoJ3VwbG9hZHByb2dyZXNzJywgZmlsZSwgZmlsZS51cGxvYWQucHJvZ3Jlc3MsIGZpbGUudXBsb2FkLmJ5dGVzU2VudCk7XG4gICAgICAgICAgICBpZiAoZmlsZS51cGxvYWQucHJvZ3Jlc3MgPT0gMTAwKSB7XG5cbiAgICAgICAgICAgICAgaWYgKGlzVXBsb2FkU3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGZpbGUuc3RhdHVzID0gIERyb3B6b25lLlNVQ0NFU1M7XG4gICAgICAgICAgICAgICAgc2VsZi5lbWl0KCdzdWNjZXNzJywgZmlsZSwgJ3N1Y2Nlc3MnLCBudWxsKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWxlLnN0YXR1cyA9ICBEcm9wem9uZS5FUlJPUjtcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ2Vycm9yJywgZmlsZSwgJ1NvbWUgdXBsb2FkIGVycm9yJywgbnVsbCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBzZWxmLmVtaXQoJ2NvbXBsZXRlJywgZmlsZSk7XG4gICAgICAgICAgICAgIHNlbGYucHJvY2Vzc1F1ZXVlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfShmaWxlLCB0b3RhbFN0ZXBzLCBzdGVwKSwgZHVyYXRpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn0pO1xuXG4vLyBGbG93LmpzXG4kKGZ1bmN0aW9uKCkge1xuICB2YXIgciA9IG5ldyBGbG93KHtcbiAgICB0YXJnZXQ6ICdodHRwOi8vcG9zdHRlc3RzZXJ2ZXIuY29tL3Bvc3QucGhwJyxcbiAgICBwZXJtYW5lbnRFcnJvcnM6IFs1MDAsIDUwMV0sXG4gICAgbWF4Q2h1bmtSZXRyaWVzOiAxLFxuICAgIGNodW5rUmV0cnlJbnRlcnZhbDogNTAwMCxcbiAgICBzaW11bHRhbmVvdXNVcGxvYWRzOiAxXG4gIH0pO1xuXG4gIC8vIEZsb3cuanMgaXNuJ3Qgc3VwcG9ydGVkLCBmYWxsIGJhY2sgb24gYSBkaWZmZXJlbnQgbWV0aG9kXG4gIGlmICghci5zdXBwb3J0KSB7XG4gICAgJCgnLmZsb3ctZXJyb3InKS5zaG93KCk7XG4gICAgcmV0dXJuIDtcbiAgfVxuXG4gIC8vIFNob3cgYSBwbGFjZSBmb3IgZHJvcHBpbmcvc2VsZWN0aW5nIGZpbGVzXG4gICQoJy5mbG93LWRyb3AnKS5zaG93KCk7XG4gIHIuYXNzaWduRHJvcCgkKCcuZmxvdy1kcm9wJylbMF0pO1xuICByLmFzc2lnbkJyb3dzZSgkKCcuZmxvdy1icm93c2UnKVswXSk7XG4gIHIuYXNzaWduQnJvd3NlKCQoJy5mbG93LWJyb3dzZS1mb2xkZXInKVswXSwgdHJ1ZSk7XG4gIHIuYXNzaWduQnJvd3NlKCQoJy5mbG93LWJyb3dzZS1pbWFnZScpWzBdLCBmYWxzZSwgZmFsc2UsIHthY2NlcHQ6ICdpbWFnZS8qJ30pO1xuXG4gIC8vIEhhbmRsZSBmaWxlIGFkZCBldmVudFxuICByLm9uKCdmaWxlQWRkZWQnLCBmdW5jdGlvbihmaWxlKXtcbiAgICAvLyBTaG93IHByb2dyZXNzIGJhclxuICAgICQoJy5mbG93LXByb2dyZXNzLCAuZmxvdy1saXN0JykucmVtb3ZlQ2xhc3MoJ2Qtbm9uZScpO1xuXG4gICAgLy8gQWRkIHRoZSBmaWxlIHRvIHRoZSBsaXN0XG4gICAgJCgnLmZsb3ctbGlzdCcpLmFwcGVuZChcbiAgICAgICc8bGkgY2xhc3M9XCJmbG93LWZpbGUgbGlzdC1ncm91cC1pdGVtIGZsb3ctZmlsZS0nK2ZpbGUudW5pcXVlSWRlbnRpZmllcisnXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiZmxvdy1wcm9ncmVzcyBtZWRpYVwiPicgK1xuICAgICAgICAgICc8ZGl2IGNsYXNzPVwibWVkaWEtYm9keVwiPicgK1xuICAgICAgICAgICAgJzxkaXY+PHN0cm9uZyBjbGFzcz1cImZsb3ctZmlsZS1uYW1lXCI+PC9zdHJvbmc+IC0gPGVtIGNsYXNzPVwiZmxvdy1maWxlLXByb2dyZXNzXCI+PHNwYW4gY2xhc3M9XCJ0ZXh0LW11dGVkXCI+V2FpdGluZy4uLjwvc3Bhbj48L2VtPjwvZGl2PicgK1xuICAgICAgICAgICAgJzxkaXY+PHNtYWxsIGNsYXNzPVwiZmxvdy1maWxlLXNpemUgdGV4dC1tdXRlZFwiPjwvc21hbGw+PC9kaXY+JyArXG4gICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICc8ZGl2IGNsYXNzPVwibWwtMyBhbGlnbi1zZWxmLWNlbnRlclwiPicgK1xuICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiZmxvdy1maWxlLWRvd25sb2FkIGJ0biBidG4tc20gaWNvbi1idG4gYnRuLW91dGxpbmUtcHJpbWFyeVwiPjxpIGNsYXNzPVwiaW9uIGlvbi1tZC1kb3dubG9hZFwiPjwvaT48L2J1dHRvbj4nICtcbiAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImZsb3ctZmlsZS1wYXVzZSBidG4gYnRuLXNtIGljb24tYnRuIGJ0bi1vdXRsaW5lLXdhcm5pbmdcIj48aSBjbGFzcz1cImlvbiBpb24tbWQtcGF1c2VcIj48L2k+PC9idXR0b24+ICcgK1xuICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiZmxvdy1maWxlLXJlc3VtZSBidG4gYnRuLXNtIGljb24tYnRuIGJ0bi1vdXRsaW5lLXN1Y2Nlc3NcIj48aSBjbGFzcz1cImlvbiBpb24tbWQtcGxheVwiPjwvaT48L2J1dHRvbj4gJyArXG4gICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJmbG93LWZpbGUtY2FuY2VsIGJ0biBidG4tc20gaWNvbi1idG4gYnRuLW91dGxpbmUtZGFuZ2VyXCI+PGkgY2xhc3M9XCJpb24gaW9uLW1kLWNsb3NlXCI+PC9pPjwvYnV0dG9uPicgK1xuICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgJzwvbGk+J1xuICAgICk7XG4gICAgdmFyICRzZWxmID0gJCgnLmZsb3ctZmlsZS0nK2ZpbGUudW5pcXVlSWRlbnRpZmllcik7XG4gICAgJHNlbGYuZmluZCgnLmZsb3ctZmlsZS1uYW1lJykudGV4dChmaWxlLm5hbWUpO1xuICAgICRzZWxmLmZpbmQoJy5mbG93LWZpbGUtc2l6ZScpLnRleHQocmVhZGFibGl6ZUJ5dGVzKGZpbGUuc2l6ZSkpO1xuICAgICRzZWxmLmZpbmQoJy5mbG93LWZpbGUtZG93bmxvYWQnKS5hdHRyKCdocmVmJywgJy9kb3dubG9hZC8nICsgZmlsZS51bmlxdWVJZGVudGlmaWVyKS5oaWRlKCk7XG4gICAgJHNlbGYuZmluZCgnLmZsb3ctZmlsZS1wYXVzZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGZpbGUucGF1c2UoKTtcbiAgICAgICRzZWxmLmZpbmQoJy5mbG93LWZpbGUtcGF1c2UnKS5oaWRlKCk7XG4gICAgICAkc2VsZi5maW5kKCcuZmxvdy1maWxlLXJlc3VtZScpLnNob3coKTtcbiAgICB9KTtcbiAgICAkc2VsZi5maW5kKCcuZmxvdy1maWxlLXJlc3VtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGZpbGUucmVzdW1lKCk7XG4gICAgICAkc2VsZi5maW5kKCcuZmxvdy1maWxlLXBhdXNlJykuc2hvdygpO1xuICAgICAgJHNlbGYuZmluZCgnLmZsb3ctZmlsZS1yZXN1bWUnKS5oaWRlKCk7XG4gICAgfSkuaGlkZSgpO1xuICAgICRzZWxmLmZpbmQoJy5mbG93LWZpbGUtY2FuY2VsJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgZmlsZS5jYW5jZWwoKTtcbiAgICAgICRzZWxmLnJlbW92ZSgpO1xuICAgIH0pO1xuICB9KTtcbiAgci5vbignZmlsZXNTdWJtaXR0ZWQnLCBmdW5jdGlvbihmaWxlKSB7XG4gICAgci51cGxvYWQoKTtcbiAgfSk7XG4gIHIub24oJ2NvbXBsZXRlJywgZnVuY3Rpb24oKXtcbiAgICAvLyBIaWRlIHBhdXNlL3Jlc3VtZSB3aGVuIHRoZSB1cGxvYWQgaGFzIGNvbXBsZXRlZFxuICAgICQoJy5mbG93LXByb2dyZXNzIC5wcm9ncmVzcy1yZXN1bWUtbGluaywgLmZsb3ctcHJvZ3Jlc3MgLnByb2dyZXNzLXBhdXNlLWxpbmsnKS5oaWRlKCk7XG4gIH0pO1xuICByLm9uKCdmaWxlU3VjY2VzcycsIGZ1bmN0aW9uKGZpbGUsbWVzc2FnZSl7XG4gICAgdmFyICRzZWxmID0gJCgnLmZsb3ctZmlsZS0nK2ZpbGUudW5pcXVlSWRlbnRpZmllcik7XG4gICAgLy8gUmVmbGVjdCB0aGF0IHRoZSBmaWxlIHVwbG9hZCBoYXMgY29tcGxldGVkXG4gICAgJHNlbGYuZmluZCgnLmZsb3ctZmlsZS1wcm9ncmVzcycpLnRleHQoJyhjb21wbGV0ZWQpJyk7XG4gICAgJHNlbGYuZmluZCgnLmZsb3ctZmlsZS1wYXVzZSwgLmZsb3ctZmlsZS1yZXN1bWUnKS5yZW1vdmUoKTtcbiAgICAkc2VsZi5maW5kKCcuZmxvdy1maWxlLWRvd25sb2FkJykuYXR0cignaHJlZicsICcvZG93bmxvYWQvJyArIGZpbGUudW5pcXVlSWRlbnRpZmllcikuc2hvdygpO1xuICB9KTtcbiAgci5vbignZmlsZUVycm9yJywgZnVuY3Rpb24oZmlsZSwgbWVzc2FnZSl7XG4gICAgLy8gUmVmbGVjdCB0aGF0IHRoZSBmaWxlIHVwbG9hZCBoYXMgcmVzdWx0ZWQgaW4gZXJyb3JcbiAgICAkKCcuZmxvdy1maWxlLScrZmlsZS51bmlxdWVJZGVudGlmaWVyKycgLmZsb3ctZmlsZS1wcm9ncmVzcycpXG4gICAgICAuYWRkQ2xhc3MoJ3RleHQtZGFuZ2VyJylcbiAgICAgIC50ZXh0KCcoZmlsZSBjb3VsZCBub3QgYmUgdXBsb2FkZWQ6ICcgKyBtZXNzYWdlICsgJyknKTtcbiAgfSk7XG4gIHIub24oJ2ZpbGVQcm9ncmVzcycsIGZ1bmN0aW9uKGZpbGUpe1xuICAgIC8vIGlmICghZmlsZS5hdmVyYWdlU3BlZWQgfHwgZmlsZS5hdmVyYWdlU3BlZWQuaW5kZXhPZigndW5kZWZpbmVkJykgIT09IC0xKSB7IHJldHVybjsgfVxuICAgIGNvbnNvbGUubG9nKGZpbGUuYXZlcmFnZVNwZWVkKVxuXG4gICAgLy8gSGFuZGxlIHByb2dyZXNzIGZvciBib3RoIHRoZSBmaWxlIGFuZCB0aGUgb3ZlcmFsbCB1cGxvYWRcbiAgICAkKCcuZmxvdy1maWxlLScrZmlsZS51bmlxdWVJZGVudGlmaWVyKycgLmZsb3ctZmlsZS1wcm9ncmVzcycpXG4gICAgICAuaHRtbChNYXRoLmZsb29yKGZpbGUucHJvZ3Jlc3MoKSoxMDApICsgJyUgJ1xuICAgICAgICArIHJlYWRhYmxpemVCeXRlcyhmaWxlLmF2ZXJhZ2VTcGVlZCkgKyAnL3MgJ1xuICAgICAgICArIHNlY29uZHNUb1N0cihmaWxlLnRpbWVSZW1haW5pbmcoKSkgKyAnIHJlbWFpbmluZycpIDtcbiAgICAkKCcuZmxvdy1wcm9ncmVzcyAucHJvZ3Jlc3MtYmFyJykuY3NzKHt3aWR0aDpNYXRoLmZsb29yKHIucHJvZ3Jlc3MoKSoxMDApICsgJyUnfSk7XG4gIH0pO1xuICByLm9uKCd1cGxvYWRTdGFydCcsIGZ1bmN0aW9uKCl7XG4gICAgLy8gU2hvdyBwYXVzZSwgaGlkZSByZXN1bWVcbiAgICAkKCcuZmxvdy1wcm9ncmVzcyAucHJvZ3Jlc3MtcmVzdW1lLWxpbmsnKS5oaWRlKCk7XG4gICAgJCgnLmZsb3ctcHJvZ3Jlc3MgLnByb2dyZXNzLXBhdXNlLWxpbmsnKS5zaG93KCk7XG4gIH0pO1xuICByLm9uKCdjYXRjaEFsbCcsIGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gIH0pO1xuICB3aW5kb3cuciA9IHtcbiAgICBwYXVzZTogZnVuY3Rpb24gKCkge1xuICAgICAgci5wYXVzZSgpO1xuICAgICAgLy8gU2hvdyByZXN1bWUsIGhpZGUgcGF1c2VcbiAgICAgICQoJy5mbG93LWZpbGUtcmVzdW1lJykuc2hvdygpO1xuICAgICAgJCgnLmZsb3ctZmlsZS1wYXVzZScpLmhpZGUoKTtcbiAgICAgICQoJy5mbG93LXByb2dyZXNzIC5wcm9ncmVzcy1yZXN1bWUtbGluaycpLnNob3coKTtcbiAgICAgICQoJy5mbG93LXByb2dyZXNzIC5wcm9ncmVzcy1wYXVzZS1saW5rJykuaGlkZSgpO1xuICAgIH0sXG4gICAgY2FuY2VsOiBmdW5jdGlvbigpIHtcbiAgICAgIHIuY2FuY2VsKCk7XG4gICAgICAkKCcuZmxvdy1wcm9ncmVzcyAucHJvZ3Jlc3MtcmVzdW1lLWxpbmsnKS5oaWRlKCk7XG4gICAgICAkKCcuZmxvdy1wcm9ncmVzcyAucHJvZ3Jlc3MtcGF1c2UtbGluaycpLmhpZGUoKTtcbiAgICAgICQoJy5mbG93LXByb2dyZXNzIC5wcm9ncmVzcy1iYXInKS5jc3Moe3dpZHRoOiAnMCUnfSk7XG4gICAgICAkKCcuZmxvdy1maWxlJykucmVtb3ZlKCk7XG4gICAgfSxcbiAgICB1cGxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgJCgnLmZsb3ctZmlsZS1wYXVzZScpLnNob3coKTtcbiAgICAgICQoJy5mbG93LWZpbGUtcmVzdW1lJykuaGlkZSgpO1xuICAgICAgci5yZXN1bWUoKTtcbiAgICB9LFxuICAgIGZsb3c6IHJcbiAgfTtcblxuICBmdW5jdGlvbiByZWFkYWJsaXplQnl0ZXMoYnl0ZXMpIHtcbiAgICBpZiAoIWJ5dGVzKSB7IHJldHVybiAnMCBrQic7IH1cblxuICAgIHZhciBzID0gWydieXRlcycsICdrQicsICdNQicsICdHQicsICdUQicsICdQQiddO1xuICAgIHZhciBlID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZygxMDI0KSk7XG4gICAgcmV0dXJuIChieXRlcyAvIE1hdGgucG93KDEwMjQsIGUpKS50b0ZpeGVkKDIpICsgXCIgXCIgKyBzW2VdO1xuICB9XG4gIGZ1bmN0aW9uIHNlY29uZHNUb1N0ciAodGVtcCkge1xuICAgIGZ1bmN0aW9uIG51bWJlckVuZGluZyAobnVtYmVyKSB7XG4gICAgICByZXR1cm4gKG51bWJlciA+IDEpID8gJ3MnIDogJyc7XG4gICAgfVxuICAgIHZhciB5ZWFycyA9IE1hdGguZmxvb3IodGVtcCAvIDMxNTM2MDAwKTtcbiAgICBpZiAoeWVhcnMpIHtcbiAgICAgIHJldHVybiB5ZWFycyArICcgeWVhcicgKyBudW1iZXJFbmRpbmcoeWVhcnMpO1xuICAgIH1cbiAgICB2YXIgZGF5cyA9IE1hdGguZmxvb3IoKHRlbXAgJT0gMzE1MzYwMDApIC8gODY0MDApO1xuICAgIGlmIChkYXlzKSB7XG4gICAgICByZXR1cm4gZGF5cyArICcgZGF5JyArIG51bWJlckVuZGluZyhkYXlzKTtcbiAgICB9XG4gICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcigodGVtcCAlPSA4NjQwMCkgLyAzNjAwKTtcbiAgICBpZiAoaG91cnMpIHtcbiAgICAgIHJldHVybiBob3VycyArICcgaG91cicgKyBudW1iZXJFbmRpbmcoaG91cnMpO1xuICAgIH1cbiAgICB2YXIgbWludXRlcyA9IE1hdGguZmxvb3IoKHRlbXAgJT0gMzYwMCkgLyA2MCk7XG4gICAgaWYgKG1pbnV0ZXMpIHtcbiAgICAgIHJldHVybiBtaW51dGVzICsgJyBtaW51dGUnICsgbnVtYmVyRW5kaW5nKG1pbnV0ZXMpO1xuICAgIH1cbiAgICB2YXIgc2Vjb25kcyA9IHRlbXAgJSA2MDtcbiAgICByZXR1cm4gc2Vjb25kcyArICcgc2Vjb25kJyArIG51bWJlckVuZGluZyhzZWNvbmRzKTtcbiAgfVxufSk7XG4iXSwiZmlsZSI6ImpzL2Zvcm1zX2ZpbGUtdXBsb2FkLmVzNS5qcyJ9
